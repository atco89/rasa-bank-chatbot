# ----------------------------------------------------------------------
# Use a specific Node base image for the container.
# ----------------------------------------------------------------------
FROM node:18.20.8-alpine

# ----------------------------------------------------------------------
# Maintainer information
# ----------------------------------------------------------------------
LABEL maintainer="Aleksandar RakiÄ‡ <aleksandar.rakic@yahoo.com>"

# ----------------------------------------------------------------------
# Define build-time arguments with default values.
# ----------------------------------------------------------------------
ARG HOMEDIR="/app"
ARG NODE_ENV="development"

# ----------------------------------------------------------------------
# Set environment variables.
# ----------------------------------------------------------------------
ENV NODE_ENV=$NODE_ENV

# ----------------------------------------------------------------------
# Set working directory.
# ----------------------------------------------------------------------
WORKDIR $HOMEDIR

# ----------------------------------------------------------------------
# Install build tools and dependencies.
# ----------------------------------------------------------------------
RUN apk update && apk add --no-cache \
      curl \
      autoconf \
      automake \
      libtool \
      build-base \
      pkgconf \
      libjpeg-turbo-dev \
      nasm \
      su-exec

# ----------------------------------------------------------------------
# Fix permissions for $HOMEDIR during build.
# ----------------------------------------------------------------------
RUN chown -R node:node $HOMEDIR && \
    exec su-exec node "$@"

# ----------------------------------------------------------------------
# Define the container's CMD.
# ----------------------------------------------------------------------
CMD ["sh", "-c", "npm install"]
